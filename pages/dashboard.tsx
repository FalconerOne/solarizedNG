import { useEffect, useState } from 'react'; import { supabase } from '../lib/supabaseClient'; import Link from 'next/link';
export default function Dashboard(){ const [sessionUser,setSessionUser]=useState<any>(null); const [userRow,setUserRow]=useState<any>(null); const [referrals,setReferrals]=useState<any[]>([]);
useEffect(()=>{ getUser(); },[]); async function getUser(){ const s = await supabase.auth.getUser(); const u = s.data?.user; setSessionUser(u); if(!u) return; const { data } = await supabase.from('users').select('*').eq('email', u.email).single(); setUserRow(data); loadReferrals(data.id); }
async function loadReferrals(uid:any){ const { data } = await supabase.from('referrals').select('*').eq('referrer_id', uid); setReferrals(data||[]); }
async function share(platform:string){ if(!userRow) return; await supabase.from('referrals').insert([{ referrer_id: userRow.id, referred_id: null, platform }]); alert('Thanks for sharing on '+platform); loadReferrals(userRow.id); }
return (<div className="min-h-screen"><div className="max-w-4xl mx-auto p-4"><h1 className="text-2xl font-bold">Your Dashboard</h1>{!sessionUser && <p className="mt-2">Please sign in with the email you used to register.</p>}{userRow && <div className="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4"><div className="bg-white p-4 rounded shadow"><h3 className="font-semibold">Your Stats</h3><p className="mt-2">Points: <strong>{userRow.total_points}</strong></p><p className="mt-1">Referrals: <strong>{userRow.total_referrals}</strong></p><p className="mt-1">Extra entries: <strong>{userRow.extra_entries}</strong></p><p className="mt-1">Activated: <strong>{userRow.activated? 'Yes':'No'}</strong></p><Link href="/leaderboard"><a className="mt-3 inline-block bg-amber-500 text-white px-3 py-1 rounded">View Leaderboard</a></Link></div><div className="bg-white p-4 rounded shadow"><h3 className="font-semibold">Referral Platforms</h3><div className="mt-2 space-y-2"><button onClick={()=>share('whatsapp')} className="w-full text-left border p-2 rounded">Share on WhatsApp</button><button onClick={()=>share('facebook')} className="w-full text-left border p-2 rounded">Share on Facebook</button><button onClick={()=>share('instagram')} className="w-full text-left border p-2 rounded">Share on Instagram</button><button onClick={()=>share('x')} className="w-full text-left border p-2 rounded">Share on X (Twitter)</button><button onClick={()=>share('telegram')} className="w-full text-left border p-2 rounded">Share on Telegram</button></div></div><div className="bg-white p-4 rounded shadow"><h3 className="font-semibold">Recent Activity</h3><div className="mt-2 text-sm text-gray-700 h-32 overflow-auto">{referrals.length===0 && <p className="text-gray-500">No referral activity yet.</p>}{referrals.map(r=>(<div key={r.id} className="p-1 border-b">{new Date(r.created_at).toLocaleString()} â€” {r.platform}</div>))}</div></div></div>}</div></div>); }
