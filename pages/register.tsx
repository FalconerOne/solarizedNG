import { useState } from 'react'; import { supabase } from '../lib/supabaseClient'; import { useRouter } from 'next/router';
function makeReferralCode(len=6){ const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; let out=''; for(let i=0;i<len;i++) out+=chars[Math.floor(Math.random()*chars.length)]; return out; }
export default function Register(){ const [name,setName]=useState(''); const [phone,setPhone]=useState(''); const [email,setEmail]=useState(''); const [location,setLocation]=useState(''); const [msg,setMsg]=useState(''); const router=useRouter();
async function submit(e:any){ e.preventDefault(); if(!name||!phone||!email||!location) return setMsg('Please fill all fields'); const code=makeReferralCode(7); const { data, error } = await supabase.from('users').insert([{ full_name: name, phone, email, location, referral_code: code }]).select().single(); if(error){ setMsg('Error: '+error.message); return; } setMsg('Registered! Please activate to be eligible for draws.'); router.push('/activate-inline?user_id='+data.id); }
return (<div className="min-h-screen flex items-center justify-center p-4"><form onSubmit={submit} className="bg-white p-6 rounded shadow w-full max-w-md"><h2 className="text-xl font-bold mb-4">Join the Giveaway</h2><label className="block">Full name<input value={name} onChange={e=>setName(e.target.value)} className="w-full border p-2 rounded mt-1"/></label><label className="block">Phone<input value={phone} onChange={e=>setPhone(e.target.value)} className="w-full border p-2 rounded mt-1"/></label><label className="block">Email<input value={email} onChange={e=>setEmail(e.target.value)} className="w-full border p-2 rounded mt-1"/></label><label className="block">Location<input value={location} onChange={e=>setLocation(e.target.value)} className="w-full border p-2 rounded mt-1"/></label><button className="mt-3 bg-amber-500 text-white px-4 py-2 rounded">Register</button>{msg && <p className="mt-3 text-sm text-gray-600">{msg}</p>}</form></div>); }
